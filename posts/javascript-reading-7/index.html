<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="JavaScript红宝书再阅读（2）" /><meta property="og:locale" content="en" /><meta name="description" content="第7章 迭代器与生成器" /><meta property="og:description" content="第7章 迭代器与生成器" /><link rel="canonical" href="https://mqsh.me/posts/javascript-reading-7/" /><meta property="og:url" content="https://mqsh.me/posts/javascript-reading-7/" /><meta property="og:site_name" content="Subaru" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-06T23:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="JavaScript红宝书再阅读（2）" /><meta name="twitter:site" content="@MQ380" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"JavaScript红宝书再阅读（2）","dateModified":"2021-03-06T23:00:00+08:00","datePublished":"2021-03-06T23:00:00+08:00","description":"第7章 迭代器与生成器","url":"https://mqsh.me/posts/javascript-reading-7/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://mqsh.me/posts/javascript-reading-7/"},"@context":"https://schema.org"}</script><title>JavaScript红宝书再阅读（2） | Subaru</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Subaru"><meta name="application-name" content="Subaru"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/poe.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Subaru</a></div><div class="site-subtitle font-italic">FE Engnieer</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/mq-380" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/MQ380" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['shmao288','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>JavaScript红宝书再阅读（2）</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>JavaScript红宝书再阅读（2）</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> MAO </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Mar 6, 2021, 11:00 PM +0800" >Mar 6<i class="unloaded">2021-03-06T23:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3530 words">19 min read</span></div></div><div class="post-content"><h1 id="第7章-迭代器与生成器">第7章 迭代器与生成器</h1><h2 id="1-迭代器">1. 迭代器</h2><p>迭代器模式描述了一个方案，即可以把有些实现了正式的Iterable接口，而且可以通过迭代器Iterator消费的结构称为”可迭代对象“（iterable）。</p><p>迭代器无需了解与其关联的可迭代对象的结构，只需要知道如何取得连续的值。</p><h3 id="可迭代协议实现iterable接口">可迭代协议（实现Iterable接口）：</h3><p>需要具备的两种能力:</p><ol><li>支持迭代的自我识别能力<li>创建实现Iterator接口的对象的能力</ol><p>在ES中，上述两点意味着：</p><ol><li>必须暴露一个属性作为”默认迭代器“，而且这个属性必须使用Symbol.iterator作为键。<li>这个迭代器必须引用一个迭代器工厂函数，调用这个工厂函数必须返回一个新迭代器。</ol><p>实现了该接口的内置类型：</p><p>字符串、数组、映射（Map）、集合（Set）、arguments对象、NodeList等DOM集合类型</p><p>接收可迭代对象的原生语言特性（自然调用迭代器对象Symbol.interator）：</p><p>for-of循环、数组解构、扩展操作符、Array.from()、创建集合、创建映射、Promise.all()接收有Promise组成的可迭代对象、Promise.race()接收有Promise组成的可迭代对象、yield*操作符</p><p>Ex.:</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">num</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span>  <span class="p">{};</span>
<span class="kd">let</span> <span class="nx">str</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">abc</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">num</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]);</span>   <span class="c1">// undefined</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">obj</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]);</span>   <span class="c1">// undefined</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]);</span>   <span class="c1">// f values() {} </span>
<span class="c1">//调用这个生成器会生成一个迭代器</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]());</span> <span class="c1">// StringIterator(); </span>

<span class="c1">//如果对象原型链上的父类实现了Iterable接口，那这个对象也实现了这个接口</span>
<span class="kd">class</span> <span class="nx">FooArray</span> <span class="kd">extends</span> <span class="nb">Array</span><span class="p">{}</span>
<span class="kd">let</span> <span class="nx">fooArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FooArray</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">el</span> <span class="k">of</span> <span class="nx">fooArr</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="迭代器协议">迭代器协议</h3><p>迭代器是一种一次性使用的对象，用于迭代与其关联的可迭代对象。迭代器API使用next()方法在可迭代对象中遍历数据。</p><p>每次成功调用next()，都会返回一个IteratorResult对象，包含两个值：</p><ol><li>value：包含可迭代对象的下一个值（done为false）、undefined（done为true）<li>done：一个布尔值，表示是否还可以再次调用next()取得下一个值。true为耗尽。</ol><p>迭代器的两点注意点：</p><ol><li>每个迭代器得到的实例之间没有关系，只会独立地遍历可迭代对象。<li>迭代器并不与迭代对象的某个时刻的快照绑定，如果对象被修改了那么迭代器也会反映变化。</ol><p>（关于2的个人想法，所以对于数组的forEach修改，前一个如果修改，那么后一个得到的内容将会是修改后的）（虽然和这个无关，但是亲测是正确）</p><p><strong>注意：迭代器维护者一个指向可迭代对象的引用，因此迭代器会阻止垃圾回收程序回收可迭代对象。</strong></p><p>Ex.</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">];</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]);</span> <span class="c1">//  f values() { [native code] }</span>

<span class="kd">let</span> <span class="nx">iter</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span> 
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter</span><span class="p">)</span>                  <span class="c1">// ArrayIterator {}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'foo'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'bar'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: true, value: undefined}</span>
<span class="c1">//只要到达next()的done为true的地方，之后无论如何调用next得到的值都为一样。</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: true, value: undefined}</span>

<span class="c1">// 每个迭代器得到的实例之间没有关系，只会独立地遍历可迭代对象</span>
<span class="kd">let</span> <span class="nx">iter1</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span> 
<span class="kd">let</span> <span class="nx">iter2</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span> 
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter1</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'foo'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter2</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'foo'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter2</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'bar'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter1</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>    <span class="c1">// {done: false, value: 'bar'}</span>

<span class="c1">//迭代器并不与迭代对象的某个时刻的快照绑定，如果对象被修改了那么迭代器也会反映变化。</span>
<span class="kd">let</span> <span class="nx">iter3</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter3</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span> <span class="c1">// {done: false, value: 'foo'}</span>
<span class="nx">arr</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter3</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span> <span class="c1">// {done: false, value: 'baz'}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">iter3</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span> <span class="c1">// {done: false, value: 'bar'}</span>
</pre></table></code></div></div><h3 id="自定义迭代器">自定义迭代器</h3><p>任何实现了Iterator接口的对象都可以作为迭代器使用。如下面例子中的Counter类。</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">Counter</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">;</span>	
	<span class="p">}</span>

	<span class="nx">next</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">count</span> <span class="o">&lt;=</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">};</span>
		<span class="p">}</span>	<span class="k">else</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">};</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]{</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="c1">//1</span>
<span class="c1">//2</span>
<span class="c1">//3</span>
<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="c1">// (nothing）</span>
</pre></table></code></div></div><p>上述对象因为直接修改了实例对象中的内容，所以每个实例的counter对象只能够被迭代一次。</p><p>为了解决这个问题，需要把计数器放在闭包中， 然后通过闭包来返回迭代器。</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">Counter</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">;</span>	
	<span class="p">}</span>

	<span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]{</span>
		<span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="nx">limit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="nx">next</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">count</span> <span class="o">&lt;=</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">count</span><span class="o">++</span><span class="p">};}</span>
				<span class="k">else</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">};</span>	
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="c1">//1</span>
<span class="c1">//2</span>
<span class="c1">//3</span>
<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">counter</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="c1">//1</span>
<span class="c1">//2</span>
<span class="c1">//3</span>
</pre></table></code></div></div><h3 id="提前终止迭代器">提前终止迭代器</h3><p>可选的return()方法用于指定在迭代器提前关闭时执行的逻辑。执行迭代的结构在想让迭代器知道它不想遍历到可迭代对象耗尽时，就可以“关闭”迭代器。</p><p>可能的情况：</p><ol><li>for-of循环通过break、continue、return或throw提前退出<li>结构操作并未消费所有值。</ol><p>return()方法必须返回一个有效的IteratorResult对象。简单情况下，可以只返回{done: true}</p><p>如果迭代器没有被关闭（done没有被设置为true），那么还可以继续从上次断开的地方继续迭代。</p><p>要知道这个迭代器是否是可以被关闭的话，只要判断return属性是不是函数对象。不过，仅仅给一个不可关闭的迭代器增加这个方法并不能让它变成可关闭的。</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">Counter</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(</span><span class="nx">limit</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="nx">limit</span><span class="p">;</span>	
	<span class="p">}</span>

	<span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]{</span>
		<span class="kd">let</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="nx">limit</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
		<span class="k">return</span> <span class="p">{</span>
			<span class="nx">next</span><span class="p">()</span> <span class="p">{</span>
				<span class="k">if</span><span class="p">(</span><span class="nx">count</span> <span class="o">&lt;=</span> <span class="nx">limit</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="nx">count</span><span class="o">++</span><span class="p">};}</span>
				<span class="k">else</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">value</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">};</span>	
			<span class="p">},</span>
			<span class="k">return</span><span class="p">()</span> <span class="p">{</span>
				<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Existing early</span><span class="dl">'</span><span class="p">);</span>
				<span class="k">return</span> <span class="p">{</span><span class="na">done</span><span class="p">:</span> <span class="kc">true</span><span class="p">};</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Counter</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">counter</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//1  2  Existing early</span>

<span class="c1">//如果迭代器没有被关闭（done没有被设置为true），那么还可以继续从上次断开的地方继续迭代。</span>
<span class="c1">//数组的迭代器是不能被关闭的。</span>

<span class="kd">let</span> <span class="nx">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">];</span>
<span class="kd">let</span> <span class="nx">iter</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]();</span>

<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">iter</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// 1 2 3</span>
<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="k">of</span> <span class="nx">iter</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
	<span class="c1">// 4 5</span>
<span class="p">}</span>
</pre></table></code></div></div><h2 id="2-生成器">2. 生成器</h2><h3 id="何为生成器">何为生成器</h3><p>生成器是ES6新增的一个极为灵活的结构，拥有在一个函数块中暂停和回复代码执行的能力。这个能力可以自定义迭代器和实现协程。</p><h3 id="生成器基础">生成器基础</h3><p>生成器的形式是一个函数，函数名称前面加一个星号（*）表示它是一个生成器。只要是可以定义函数的地方，就可以定义生成器。</p><p><strong>注意：箭头函数不能用来定义生成器函数。</strong></p><p>调用生成器函数会产生一个生成器对象。生成器对象一开始处于暂停执行的状态（suspended）。与迭代器类似，生成器也实现了Iterator接口，因此具有next()方法，调用这个方法会让生成器开始或回复执行。</p><p>next返回的value为生成器函数的返回值，默认值为undefined。可以通过return 来指定。</p><p>生成器函数只会在初次调用next()方法后开始执行。</p><p>生成器对象实现了Iterator接口，默认的迭代器是自引用的。</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre><span class="c1">//生成器函数声明</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">generatorFn</span><span class="p">()</span> <span class="p">{}</span>
<span class="c1">//生成器函数表达式</span>
<span class="kd">let</span> <span class="nx">generatorFn</span> <span class="o">=</span> <span class="kd">function</span><span class="o">*</span> <span class="p">()</span> <span class="p">{}</span>
<span class="c1">//作为对象字面量方法的生成器函数</span>
<span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">*</span> <span class="nx">generatorFn</span> <span class="p">()</span> <span class="p">{},</span>
<span class="p">}</span>
<span class="c1">//作为类实例方法的生成器函数</span>
<span class="kd">class</span> <span class="nx">Foo</span> <span class="p">{</span>
	<span class="o">*</span> <span class="nx">generatorFn</span><span class="p">()</span> <span class="p">{};</span>
<span class="p">}</span>
<span class="c1">//作为类静态方法的生成器函数</span>
<span class="kd">class</span> <span class="nx">Bar</span> <span class="p">{</span>
	<span class="kd">static</span> <span class="o">*</span> <span class="nx">generatorFn</span><span class="p">()</span> <span class="p">{};</span>
<span class="p">}</span>

<span class="c1">//生成器对象的生成</span>
<span class="kd">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">generatorFn</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="c1">// generatorFn( &lt;suspended&gt; )</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">)</span> <span class="c1">// f next() { [native code] }</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">())</span> <span class="c1">// { done: true, value: undefined } </span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">generatorFn1</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//初次调用并不会打印日志</span>
<span class="kd">let</span> <span class="nx">gO</span> <span class="o">=</span> <span class="nx">generatorFn1</span><span class="p">();</span>
<span class="c1">//手动调用next之后才会调用。</span>
<span class="nx">generatorFn1</span><span class="p">.</span><span class="nx">next</span><span class="p">();</span> <span class="c1">// foo</span>

<span class="c1">//自引用迭代器</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g</span> <span class="o">===</span> <span class="nx">g</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">]())</span> <span class="c1">// true</span>
</pre></table></code></div></div><h3 id="使用yield来中断执行">使用yield来中断执行</h3><p>生成器函数在遇到yield之前会正常执行。遇到之后，会停止，函数作用域的状态会被保留。停止执行的生成器函数只能通过生成器对象上调用next()来恢复执行。</p><p>yield有点类似于函数的中间返回语句。通过yield退出的生成器函数会处在{ done: false }的状态。通过return返回的done会成为true。</p><p>生成器内部的执行流程会针对每一个生成器对象区分作用域。在一个生成器对象上调用next()不会影响其他生成器（类似于迭代器的机制）。</p><p>yield只能直接在生成器函数内部使用，在其他地方或者嵌套使用会抛出错误。</p><p>yield的作用：</p><ol><li>生成器对象作为可迭代对象。<li>使用yield实现输入和输出。<li><p>产生可迭代对象（yield *）。</p><p>yield* 实际上只是讲一个可迭代对象序列化为一连串可以单独阐述的值。所以这把yield放入一个循环中并没有什么不同。yield*的值是关联迭代器返回done: true时的value属性，对于普通迭代器来说，这个值是undefined，对于生成函数产生的迭代器来说，这个值是return的值。</p><li><p>使用yield*实现递归算法。</p><p>这个内容可以用来实现图，并且实现深度优先遍历等图的算法（具体代码参考P200-201）</p></ol><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
</pre><td class="rouge-code"><pre><span class="c1">// 1 生成器对象作为可迭代对象。</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">generatorFn</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">yield</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">yield</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">yield</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="nx">generatorFn</span><span class="p">())</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">//1 2 3</span>

<span class="c1">// 需要自定义迭代对象时，这样使用生成器对象会比较有用：</span>
<span class="c1">// 需要定义一个可迭代对象，他会产生一个迭代器，这个迭代器会执行指定的次数。</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">nTimes</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">n</span><span class="o">--</span><span class="p">)</span> <span class="k">yield</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">_</span> <span class="k">of</span> <span class="nx">nTimes</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// foo foo foo</span>

<span class="c1">// 2 使用yield实现输入和输出。</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">generator2</span><span class="p">(</span><span class="nx">init</span><span class="p">){</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">init</span><span class="p">);</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">yield</span><span class="p">);</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">yield</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// yield位置会接受到next方法的第一个参数。</span>
<span class="c1">// 但是第一次调用next传入的直不会被使用，因为这只是开始生成器</span>
<span class="kd">let</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">generator2</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// foo</span>
<span class="nx">g</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// baz  (attention!)</span>

<span class="c1">//yield也可以输出内容</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">ge3</span><span class="p">(){</span>
	<span class="k">return</span> <span class="k">yield</span> <span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">let</span> <span class="nx">g2</span> <span class="o">=</span> <span class="nx">ge3</span><span class="p">();</span>
<span class="c1">//先遇到yield传出foo，然后在return yield传入的内容bar</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g2</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span>  <span class="c1">// { done: false, value: 'foo' }</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g2</span><span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">));</span> <span class="c1">// { done: true, value: 'bar' }</span>
<span class="c1">//无穷计数器</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">infi</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">){</span>
		<span class="k">yield</span> <span class="nx">i</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">infig</span> <span class="o">=</span> <span class="nx">infi</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">infig</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">infig</span><span class="p">.</span><span class="nx">next</span><span class="p">().</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// 2</span>
<span class="c1">//...</span>

<span class="c1">//亦可以实现范围和填充数组</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">range</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">end</span> <span class="o">&gt;</span> <span class="nx">start</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">yield</span> <span class="nx">start</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="nx">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span> <span class="c1">// 4 5 6</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">zeroes</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">while</span><span class="p">(</span><span class="nx">n</span><span class="o">--</span><span class="p">)</span> <span class="k">yield</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">zeroes</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span> <span class="c1">// 8个0的数组</span>

<span class="c1">// 3 yield* </span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">ge4</span> <span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span> <span class="p">(</span><span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span> <span class="k">yield</span> <span class="nx">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span><span class="o">*</span> <span class="nx">ge4equal</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">yield</span><span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span>

<span class="c1">// 4 递归算法</span>
<span class="kd">function</span> <span class="o">*</span> <span class="nx">nTimes</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">yield</span> <span class="nx">nTimes</span><span class="p">(</span><span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">yield</span> <span class="nx">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>	
	<span class="p">}</span>
<span class="p">}</span>
<span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="nx">nTimes</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 0 1 2 </span>

</pre></table></code></div></div><h3 id="生成器作为默认迭代器">生成器作为默认迭代器</h3><p>这里for-of循环调用了默认迭代器（是一个生成器函数）</p><p>例子：</p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">class</span> <span class="nx">Foo</span> <span class="p">{</span>
	<span class="kd">constructor</span><span class="p">(){</span>
		<span class="k">this</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="p">[</span><span class="nb">Symbol</span><span class="p">.</span><span class="nx">iterator</span><span class="p">](){</span>
		<span class="k">yield</span><span class="o">*</span> <span class="k">this</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>	
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">();</span>
<span class="k">for</span><span class="p">(</span><span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="nx">foo</span><span class="p">)</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">);</span>

<span class="c1">// 1 2 3</span>
</pre></table></code></div></div><h3 id="提前终止迭代器-1">提前终止迭代器</h3><p>return和throw方法都可以用于生成器进入关闭状态。</p><p>与迭代器不同，所有生成器都有return()，一旦调用就无法回复了。</p><p>for-of循环等语言内置语言结构会忽略状态done为true的返回值。</p><p>throw()方法会在暂停的时候将一个提供的错误注入到生成器对象中，如果没有被处理生成器就会被关闭。不过假如生成器函数内部处理了这个错误，那么就不会被关闭，并且可以恢复执行，错误处理会跳过相应的yield。</p><p><strong>注意：如果生成器对象还没有执行，那么调用的throw抛出的错误不会在函数内部被捕获，相当于在函数块外部抛出了错误。</strong></p><div class="language-jsx highlighter-rouge"><div class="code-header"> <span text-data=" Jsx "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">function</span><span class="o">*</span> <span class="nx">geThrow</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">yield</span><span class="o">*</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">geThrow</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
	<span class="nx">g</span><span class="p">,</span><span class="k">throw</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span> <span class="c1">// foo</span>
<span class="p">}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">g</span><span class="p">)</span> <span class="c1">// closed</span>

<span class="c1">//内部处理了error</span>
<span class="kd">function</span><span class="o">*</span> <span class="nx">geCatch</span><span class="p">()</span> <span class="p">{</span>
	<span class="k">for</span><span class="p">(</span> <span class="kd">const</span> <span class="nx">x</span> <span class="k">of</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">try</span> <span class="p">{</span>
			<span class="k">yield</span> <span class="nx">x</span>
		<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){};</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">gC</span> <span class="o">=</span> <span class="nx">geCatch</span><span class="p">();</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gC</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span> <span class="c1">// {done: false, value: 1} </span>
<span class="c1">// 因为yield抛出的错误在内部被捕获，所以不会产出2</span>
<span class="nx">gC</span><span class="p">.</span><span class="k">throw</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gC</span><span class="p">.</span><span class="nx">next</span><span class="p">());</span> <span class="c1">// {done: false, value: 3}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E6%8A%80%E6%9C%AF/'>技术</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/javascript/" class="post-tag no-text-decoration" >JavaScript</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" class="post-tag no-text-decoration" >前端</a> <a href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="post-tag no-text-decoration" >读书笔记</a> <a href="/tags/%E5%86%8D%E5%AD%A6%E4%B9%A0/" class="post-tag no-text-decoration" >再学习</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=JavaScript红宝书再阅读（2） - Subaru&url=https://mqsh.me/posts/javascript-reading-7/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=JavaScript红宝书再阅读（2） - Subaru&u=https://mqsh.me/posts/javascript-reading-7/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=JavaScript红宝书再阅读（2） - Subaru&url=https://mqsh.me/posts/javascript-reading-7/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/never-say-never/">Never say never —— 致敬2021</a><li><a href="/posts/saygoodbye/">诀别</a><li><a href="/posts/KMT/">精诚团结，人民做主</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a> <a class="post-tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a> <a class="post-tag" href="/tags/%E5%B9%B4%E7%BB%88/">年终</a> <a class="post-tag" href="/tags/%E6%96%B0%E5%B9%B4/">新年</a> <a class="post-tag" href="/tags/%E5%9B%BE/">图</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/%E5%8E%86%E5%8F%B2/">历史</a> <a class="post-tag" href="/tags/%E8%AF%BB%E4%B9%A6/">读书</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/javascript-reading-9/"><div class="card-body"> <span class="timeago small" >Mar 3<i class="unloaded">2021-03-03T19:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JavaScript红宝书再阅读（1）</h3><div class="text-muted small"><p> 第9章 代理与反射 注意：本章的内容是ES6之后的专属，注意兼容性。 1. 代理的定义与创建 代理是目标对象的抽象，类似于C++的指针。可以用作目标对象的替身，但又完全独立于目标对象。 Ex: const target = { id: 'target', }; const handler = {}; //需要两个参数，一个是目标对象，一个是处理程序对象，生成一个新的代理对象 ...</p></div></div></a></div><div class="card"> <a href="/posts/design/"><div class="card-body"> <span class="timeago small" >Jul 16, 2017<i class="unloaded">2017-07-16T00:03:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>课程设计前端踩坑记录</h3><div class="text-muted small"><p> 使用vue框架完成这个课程设计（第一次使用）已经完成了好长时间了，总结了一下使用框架的10条踩坑经验。 （这个老师的课就是个坑，给分超低。） 课程设计的代码全部保存在github上，地址：GitHub - MQ-380/Manager: First try on Vue （webproject为所有前端部分） 数据的保存与传输 localstorage和sessionst...</p></div></div></a></div><div class="card"> <a href="/posts/js1/"><div class="card-body"> <span class="timeago small" >Aug 10, 2017<i class="unloaded">2017-08-10T00:03:36+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JavaScript精进之路 — 函数、闭包与原型链</h3><div class="text-muted small"><p> 开这个专题，说实话，就是为了准备校招，补补基础知识吧。 今天这个话题是因为这几天看了《JavaScript忍者秘籍》，感觉这本书把这几个内容讲的蛮透彻了，特撰本文，以便日后翻阅。（应该都会以知识点的形式给出吧。） 函数 【基本类型】JavaScript中函数为first-class object，typeof的结果是object，没有function这个基本类型，但有可以...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/javascript-reading-9/" class="btn btn-outline-primary" prompt="Older"><p>JavaScript红宝书再阅读（1）</p></a> <a href="/posts/react3/" class="btn btn-outline-primary" prompt="Newer"><p>React和它的小伙伴们(3) - React Hooks</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/mq380">MAO</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">数据结构</a> <a class="post-tag" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a> <a class="post-tag" href="/tags/%E5%B9%B4%E7%BB%88/">年终</a> <a class="post-tag" href="/tags/%E6%96%B0%E5%B9%B4/">新年</a> <a class="post-tag" href="/tags/%E5%9B%BE/">图</a> <a class="post-tag" href="/tags/javascript/">JavaScript</a> <a class="post-tag" href="/tags/react/">React</a> <a class="post-tag" href="/tags/%E5%8E%86%E5%8F%B2/">历史</a> <a class="post-tag" href="/tags/%E8%AF%BB%E4%B9%A6/">读书</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-74221043-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-74221043-1'); }); </script>
